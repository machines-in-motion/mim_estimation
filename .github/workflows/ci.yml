name: check_main_branch_and_deploy_doc

on: [push, pull_request]

env:
  # Customize the CMake build type here (Release, Debug, RelWithDebInfo, etc.)
  BUILD_TYPE: ${{ matrix.build_type }}
  BUILD_FOLDER: ${{github.workspace}}/../build
  DEVEL_FOLDER: ${{github.workspace}}/../devel

jobs:
  build:
    # The CMake configure and build commands are platform agnostic and should work equally
    # well on Windows or Mac.  You can convert this to a matrix build if you need
    # cross-platform coverage.
    # See: https://docs.github.com/en/free-pro-team@latest/actions/learn-github-actions/managing-complex-workflows#using-a-build-matrix
    runs-on: ${{ matrix.os }}

    strategy:
      matrix:
          os: [ubuntu-20.04]
          build_type: [Release, Debug]

    steps:
      #
      # Setup the machines and build environment
      #
      - name: Setup OS.
        uses: machines-in-motion/mim_github_actions/setup_ubuntu20_04@main
        if: ${{ ${{ matrix.os }} == "ubuntu-20.04" }}

      #
      # Checkout the current package locally
      #
      - name: Checkout current repo.
        uses: actions/checkout@v2

      #
      # Activate the secret ssh key
      #
      - name: Spawn ssh-agent
        uses: webfactory/ssh-agent@v0.5.2
        with:
          ssh-private-key: ${{ secrets.GA_SSH_PRIVATE_KEY }}

      #
      # Build and test the current package.
      #
      - name: Build and run CTest.
        uses: machines-in-motion/mim_github_actions/cmake_build_and_ctest@main
